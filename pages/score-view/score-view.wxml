<!--score-view.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="assignment-info">
      <view class="assignment-name">{{assignmentInfo.name}}</view>
      <view class="assignment-meta">
        <text class="type">{{assignmentInfo.type}}</text>
        <text class="questions">{{assignmentInfo.questionCount}}é¢˜</text>
        <text class="date">{{assignmentInfo.createdAt}}</text>
      </view>
    </view>
    <view class="stats-info">
      <view class="stat-item">
        <text class="stat-value">{{statistics.gradedCount}}/{{statistics.totalCount}}</text>
        <text class="stat-label">å·²æ‰¹æ”¹</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{statistics.averageScore}}</text>
        <text class="stat-label">å¹³å‡åˆ†</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-section">
    <view class="filter-buttons">
      <button class="filter-btn {{filterType === 'all' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="all">å…¨éƒ¨</button>
      <button class="filter-btn {{filterType === 'graded' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="graded">å·²æ‰¹æ”¹</button>
      <button class="filter-btn {{filterType === 'ungraded' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="ungraded">æœªæ‰¹æ”¹</button>
    </view>
    
    <picker class="sort-picker" range="{{sortOptions}}" value="{{sortType}}" bindchange="onSortChange">
      <view class="sort-button">
        <text>{{sortOptions[sortType]}}</text>
        <text class="sort-icon">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- æˆç»©åˆ—è¡¨ -->
  <view class="score-list" wx:if="{{filteredScores.length > 0}}">
    <view class="score-item" wx:for="{{filteredScores}}" wx:key="id" bindtap="onScoreDetail" data-score="{{item}}">
      <view class="student-info">
        <view class="student-name">{{item.studentName}}</view>
        <view class="student-number">{{item.studentNumber}}</view>
      </view>
      
      <view class="score-info" wx:if="{{item.isGraded}}">
        <view class="total-score">{{item.totalScore}}åˆ†</view>
        <view class="score-details" wx:if="{{showDetails}}">
          <!-- æ ‡å‡†è®¡åˆ†è¯¦æƒ… -->
          <view class="sub-scores" wx:if="{{assignmentInfo.scoringMode === 'standard' && assignmentInfo.hasSubQuestions}}">
            <text class="sub-score" wx:for="{{item.subScores}}" wx:key="index" wx:for-item="subScore">
              ç¬¬{{index + 1}}é¢˜: {{subScore}}åˆ†
            </text>
          </view>
          
          <!-- è‡ªå®šä¹‰è®¡åˆ†è¯¦æƒ… -->
          <view class="question-scores" wx:if="{{assignmentInfo.scoringMode === 'custom'}}">
            <text class="question-score" wx:for="{{item.questionScores}}" wx:key="index" wx:for-item="qScore">
              ç¬¬{{index + 1}}é¢˜: {{qScore}}åˆ†
            </text>
          </view>
        </view>
        
        <view class="comment" wx:if="{{item.comment}}">
          <text class="comment-label">è¯„è¯­ï¼š</text>
          <text class="comment-text">{{item.comment}}</text>
        </view>
        
        <view class="score-meta">
          <text class="graded-time">{{item.gradedTime}}</text>
        </view>
      </view>
      
      <view class="ungraded-info" wx:else>
        <view class="ungraded-status">æœªæ‰¹æ”¹</view>
        <button class="grade-btn" bindtap="onGradeStudent" data-student="{{item}}">
          æ‰¹æ”¹
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredScores.length === 0}}" style="width: 627rpx; display: block; box-sizing: border-box">
    <view class="empty-icon">ğŸ“Š</view>
    <view class="empty-text">{{emptyText}}</view>
    <button class="start-grade-btn" wx:if="{{filterType === 'ungraded'}}" bindtap="onStartGrading">
      å¼€å§‹æ‰¹æ”¹
    </button>
  </view>

  <!-- ç»Ÿè®¡å›¾è¡¨ -->
  <view class="charts-section" wx:if="{{statistics.gradedCount > 0}}">
    <view class="section-title">æˆç»©åˆ†æ</view>
    
    <!-- åˆ†æ•°åˆ†å¸ƒ -->
    <view class="chart-item">
      <view class="chart-title">åˆ†æ•°åˆ†å¸ƒ</view>
      <view class="distribution-chart">
        <view class="distribution-bar" wx:for="{{scoreDistribution}}" wx:key="range">
          <view class="bar-label">{{item.range}}</view>
          <view class="bar-container">
            <view class="bar-fill" style="width: {{item.percentage}}"></view>
          </view>
          <view class="bar-count">{{item.count}}äºº</view>
        </view>
      </view>
    </view>
    
    <!-- æ’åæ¦œ -->
    <view class="chart-item">
      <view class="chart-title">æˆç»©æ’å</view>
      <view class="ranking-list">
        <view class="ranking-item" wx:for="{{topStudents}}" wx:key="id">
          <view class="rank-number rank-{{index < 3 ? index + 1 : 'other'}}">{{index + 1}}</view>
          <view class="rank-student">
            <view class="rank-name">{{item.studentName}}</view>
            <view class="rank-number-text">{{item.studentNumber}}</view>
          </view>
          <view class="rank-score">{{item.totalScore}}åˆ†</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn" bindtap="onToggleDetails">
      {{showDetails ? 'éšè—è¯¦æƒ…' : 'æ˜¾ç¤ºè¯¦æƒ…'}}
    </button>
    <button class="action-btn primary" bindtap="onExportScores">
      å¯¼å‡ºæˆç»©
    </button>
  </view>
</view>